<!DOCTYPE html>
<html lang="en">
<head>
    <title>La web del curso</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="estilos.css"/>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function () {

            var ini = 0;
            var responseS = 0;

            function gtJson(tTable) {
                var auxTable;
                if (tTable == 'i') {
                    auxTable = 'table#tabla-impares'
                } else {
                    auxTable = 'table#tabla-pares'
                }
                $.getJSON('clientes.php', {cond: tTable, in: ini})
                        .done(function (rta) {
                            var tablaParesBody = $(auxTable).find('tbody');
                            if (tablaParesBody.find('tr').length == 1) {
                                tablaParesBody.html('');
                            }
                            if (rta != 1) {
                                $.each(rta, function (k) {
                                    $(auxTable + '>tbody').append(
                                            $('<tr>').append(
                                                    $('<td>').addClass("text-center").append(
                                                            $("<img>").attr("src", rta[k]['logo'])),
                                                    $('<td>').text(rta[k]['id']),
                                                    $('<td>').text(rta[k]['razonSocial']),
                                                    $('<td>').text(rta[k]['presidente'].nombre + ' ' + rta[k]['presidente'].apellido),
                                                    $('<td>').addClass('text-right').addClass(rta[k]['activo'] >= rta[k]['pasivo'] ? 'success' : 'danger').text("$"+(rta[k]['activo'] - rta[k]['pasivo']).toFixed(2))
                                            )
                                    )
                                });
                            }
                            if (rta == 1) {
                                $('div#mensaje-alerta').html('<div  class=\"alert alert-success\"><span class=\"glyphicon glyphicon-check\"></span> No hay mas clientes disponibles.</div>');
                                $('#boton-buscar').attr("disabled", true);
                            } else {
                                finished();
                            }
                        })
                        .fail(function () {
                            alert('error');
                            $('#boton-buscar').attr("disabled", false);
                        });
            }

            function finished() {
                if (++responseS == 2) {
                    $('#boton-buscar').attr("disabled", false);
                    ini = ini + 10;
                    responseS = 0;
                }

            }

            $('#boton-buscar').click(function () {
                $(this).attr("disabled", true);
                $.get("http://ccvalsina.com/cursoweb/autorizacion.php")
                        .done(function () {
                            $('div#mensaje-alerta').html('<div  class=\"alert alert-success\"><span class=\"glyphicon glyphicon-ok-sign\"></span> El servidor esta disponible para atender el pedido.</div>');
                            //$('div#mensaje-alerta').attr("class", "alert alert-success").text("El servidor esta disponible para atender el pedido.");
                            gtJson('p');
                            gtJson('i');
                        })
                        .fail(function () {
                            $('div#mensaje-alerta').html('<div  class=\"alert alert-danger\"><span class=\"glyphicon glyphicon-info-sign\"></span> El servidor se encuentra ocupado. Porfavor aguarde e intente nuevamente.</div>');
                            //$('div#mensaje-alerta').attr("class", "alert alert-danger").text("El servidor se encuentra ocupado. Por favor aguarde e intente nuevamente.");
                            $('#boton-buscar').attr("disabled", false);
                        });
            });
        });
    </script>
</head>
<body>
<div class="container">
    <div class="jumbotron text-center">
        <div class="row">
            <div class="col-md-12">
                <h1>Telapong S.A.</h1>

                <p>Listado de clientes oficiales</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a href="" class="navbar-brand" href="#">Telapong S.A.</a>
                    </div>
                    <ul class="nav navbar-nav">
                        <li><a>Listado de clientes</a></li>
                        <li><a>Nuevo cliente</a></li>
                    </ul>

                </div>

            </nav>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 text-left">
            <button id="boton-buscar" class="btn btn-primary btn-lg">
                <span class="glyphicon glyphicon-search"></span> Buscar
            </button>
            <br>
            <br>
        </div>
        <div class="col-md-8">
            <div id="mensaje-alerta">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <h1>Impares</h1>
            <table id="tabla-impares" class="table table-bordered table-striped table-hover">
                <thead>
                <tr>
                    <td></td>
                    <td>ID</td>
                    <td>Razon Social</td>
                    <td>Presidente</td>
                    <td>Patrimonio neto</td>
                </tr>
                </thead>
                <tbody>
                <td class="text-center" colspan="5">Sin clientes. Debe realizar una busqueda.</td>
                </tbody>
            </table>

        </div>
        <div class="col-md-6">

            <h1>Pares</h1>
            <table id="tabla-pares" class="table table-bordered table-striped table-hover">
                <thead>
                <tr>
                    <td></td>
                    <td>ID</td>
                    <td>Razon Solcial</td>
                    <td>Presidente</td>
                    <td>Patrimonio neto</td>
                </tr>
                </thead>
                <tbody>
                <td class="text-center" colspan="5">Sin clientes. Debe realizar una busqueda.</td>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>